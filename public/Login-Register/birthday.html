<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Birthday Input</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .animate-float {
        animation: float 4s ease-in-out infinite;
        will-change: transform;
      }

      .fade-in {
        animation: fadeIn 1.5s ease-out both;
      }

      .card {
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }

      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      .dropdown-list {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(236, 72, 153, 0.3);
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        20%,
        60% {
          transform: translateX(-10px);
        }
        40%,
        80% {
          transform: translateX(10px);
        }
      }

      .shake {
        animation: shake 0.5s ease;
      }

      .error {
        border-color: #f43f5e !important;
        box-shadow: 0 0 10px rgba(244, 63, 94, 0.6);
      }

      /* Text color for DD, MM, YYYY buttons */
      .dropdown-btn span:first-child {
        color: #ff4d6d;
        font-weight: 500;
      }

      /* Dropdown list text color */
      .dropdown-list li {
        color: #ff4d6d;
      }

      /* When user hovers over an option */
      .dropdown-list li:hover {
        background-color: #ffe4ea; /* soft pink hover background */
        color: #ff4d6d;
      }
    </style>
  </head>

  <body
    class="flex items-center justify-center min-h-screen px-4 relative"
    style="
      background-image: url('bgimg.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    "
  >
    <!-- Back Button -->
    <button onclick="window.location.href='enter-name.html'" class="absolute top-6 left-6 bg-white/70 backdrop-blur-xl border border-white/60 shadow-lg text-black text-sm font-medium hover:scale-105 transition px-4 py-2 rounded-full">
      ← Back
    </button>

    <div
      class="card animate-float fade-in bg-white/15 rounded-3xl p-8 sm:p-10 md:p-12 lg:p-14 text-center shadow-2xl w-full max-w-[420px] sm:max-w-[480px] md:max-w-[520px] lg:max-w-[600px] xl:max-w-[640px] border border-white/30"
    >
      <h2
        class="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-semibold text-black mb-8 drop-shadow-sm"
      >
        When's your birthday?
      </h2>

      <div class="flex flex-col items-center mt-10">
        <div class="flex flex-wrap justify-center gap-4 sm:gap-6 mb-10">
          <!-- Day -->
          <div class="relative flex flex-col items-center w-20 sm:w-24 md:w-36">
            <label class="text-black font-medium mb-1 text-sm sm:text-base">Day</label>
            <button
              id="dayBtn"
              class="dropdown-btn w-full px-4 py-3 text-base sm:text-lg rounded-full border border-black bg-transparent text-gray-700 hover:bg-transparent focus:ring-2 focus:ring-pink-400 transition-all duration-200 flex justify-between items-center backdrop-blur-sm"
            >
              <span>DD</span>
              <span style="color: #FF4D6D;">▼</span>
            </button>

            <ul
              id="dayList"
              class="dropdown-list absolute left-0 top-full mt-1 hidden bg-white rounded-xl max-h-48 overflow-y-auto no-scrollbar text-gray-700 text-base w-full z-50"
            ></ul>
          </div>

          <!-- Month -->
          <div class="relative flex flex-col items-center w-28 sm:w-32 md:w-36">
            <label class="text-black font-medium mb-1 text-sm sm:text-base">Month</label>
            <button
              id="monthBtn"
              class="dropdown-btn w-full px-4 py-3 text-base sm:text-lg rounded-full border border-black bg-transparent text-gray-700 hover:bg-transparent focus:ring-2 focus:ring-pink-400 transition-all duration-200 flex justify-between items-center backdrop-blur-sm"
            >
              <span>MM</span>
              <span style="color: #FF4D6D;">▼</span>
            </button>

            <ul
              id="monthList"
              class="dropdown-list absolute left-0 top-full mt-1 hidden bg-white rounded-xl max-h-48 overflow-y-auto no-scrollbar text-gray-700 text-base w-full z-50"
            ></ul>
          </div>

          <!-- Year -->
          <div class="relative flex flex-col items-center w-24 sm:w-28 md:w-32">
            <label class="text-black font-medium mb-1 text-sm sm:text-base">Year</label>
            <button
              id="yearBtn"
              class="dropdown-btn w-full px-4 py-3 text-base sm:text-lg rounded-full border border-black bg-transparent text-gray-700 hover:bg-transparent focus:ring-2 focus:ring-pink-400 transition-all duration-200 flex justify-between items-center backdrop-blur-sm"
            >
              <span>YYYY</span>
              <span style="color: #FF4D6D;">▼</span>
            </button>

            <ul
              id="yearList"
              class="dropdown-list absolute left-0 top-full mt-1 hidden bg-white rounded-xl max-h-48 overflow-y-auto no-scrollbar text-gray-700 text-base w-full z-50"
            ></ul>
          </div>
        </div>

        <div class="flex justify-start mt-4 ml-[calc(50%+40px)]">
          <button
            id="nextBtn"
            class="bg-rose-500 hover:bg-rose-600 text-white px-10 py-3 rounded-full text-lg font-medium shadow-md hover:shadow-lg hover:scale-105 transition-all duration-300 w-24 sm:w-28 md:w-32"
          >
            Next
          </button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const createList = (id, values, type) => {
          const list = document.getElementById(id);
          values.forEach((val) => {
            const li = document.createElement("li");
            li.textContent = val;
            li.className =
              "px-4 py-3 hover:bg-pink-50 cursor-pointer border-b border-gray-100 last:border-b-0";
            li.onclick = () => selectValue(type, val);
            list.appendChild(li);
          });
        };

        // Day list
        createList(
          "dayList",
          Array.from({ length: 31 }, (_, i) => String(i + 1).padStart(2, "0")),
          "day"
        );

        // Month list
        createList(
          "monthList",
          [
            "January","February","March","April","May","June",
            "July","August","September","October","November","December",
          ],
          "month"
        );

        // Year list
        const currentYear = new Date().getFullYear();
        createList(
          "yearList",
          Array.from({ length: currentYear - 1899 }, (_, i) => currentYear - i),
          "year"
        );

        // Dropdown toggle logic
        const dropdowns = [
          { btn: "dayBtn", list: "dayList" },
          { btn: "monthBtn", list: "monthList" },
          { btn: "yearBtn", list: "yearList" },
        ];

        dropdowns.forEach(({ btn, list }) => {
          const button = document.getElementById(btn);
          const dropdown = document.getElementById(list);

          button.dataset.selected = "false";
          button.addEventListener("click", (e) => {
            e.stopPropagation();
            document.querySelectorAll(".dropdown-list").forEach((dd) => {
              if (dd !== dropdown) dd.classList.add("hidden");
            });
            dropdown.classList.toggle("hidden");
          });
        });

        document.addEventListener("click", (e) => {
          document
            .querySelectorAll(".dropdown-list")
            .forEach((dd) => dd.classList.add("hidden"));
        });
      });

      function selectValue(type, value) {
        const button = document.getElementById(`${type}Btn`);
        const spans = button.querySelectorAll("span");
        spans[0].textContent = value; // update only the text span
        button.classList.add("bg-white", "text-pink-700", "font-medium");
        button.dataset.selected = "true";
      }

      function triggerAlarm(button) {
        button.classList.add("shake");
        setTimeout(() => button.classList.remove("shake"), 500);
      }

      document.getElementById("nextBtn").addEventListener("click", () => {
        const dayBtn = document.getElementById("dayBtn");
        const monthBtn = document.getElementById("monthBtn");
        const yearBtn = document.getElementById("yearBtn");

        let allSelected = true;

        [dayBtn, monthBtn, yearBtn].forEach((btn) => {
          if (btn.dataset.selected !== "true") {
            btn.classList.add("error");
            triggerAlarm(btn);
            allSelected = false;
          } else {
            btn.classList.remove("error");
          }
        });

        if (!allSelected) {
          alert("⚠️ Please select your full birthday before continuing!");
          return;
        }

        // Get selected values
        const day = dayBtn.querySelector("span:first-child").textContent;
        const month = monthBtn.querySelector("span:first-child").textContent;
        const year = yearBtn.querySelector("span:first-child").textContent;

        // Convert month name to number
        const monthNames = ["January", "February", "March", "April", "May", "June",
          "July", "August", "September", "October", "November", "December"];
        const monthNum = monthNames.indexOf(month) + 1;

        // Create date object
        const dob = new Date(year, monthNum - 1, parseInt(day));
        const today = new Date();
        const age = today.getFullYear() - parseInt(year) - (today.getMonth() < monthNum - 1 || (today.getMonth() === monthNum - 1 && today.getDate() < parseInt(day)) ? 1 : 0);

        // Validate age (must be at least 18)
        if (age < 18) {
          alert("⚠️ You must be at least 18 years old to register.");
          return;
        }

        if (dob > today) {
          alert("⚠️ Date of birth cannot be in the future.");
          return;
        }

        // Store DOB as ISO string
        localStorage.setItem('dob', dob.toISOString());
        window.location.href = "batch_og.html";
      });
    </script>
  </body>
</html>
