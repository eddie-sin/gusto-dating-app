<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Crushes</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Rufina:wght@400;700&family=Oleo+Script&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Rufina:wght@400;700&family=Oleo+Script&family=Itim&family=Orbit&family=Old+Standard+TT:wght@400;700&family=Jomolhari&display=swap" rel="stylesheet">

<style>
body {
  background: url('/img/bgimg.jpg') no-repeat center center fixed;
  background-size: cover;
  font-family: 'Rufina', serif;
}

/* Navbar background*/
.nav-box {
  background: rgba(255, 255, 255, 0.5);
  backdrop-filter: blur(14px);
}

/* Columns */
.column-box {
  background: rgba(255, 255, 255, 0.12);
  backdrop-filter: blur(14px);
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 28px;
  padding: 18px;
  display: flex;
  flex-direction: column;
}

.scrollable {
  max-height: 60vh;
  overflow-y: auto;
  padding-right: 4px;
}

/* Headers (both titles same style) */
.column-title {
  font-size: 2.5rem;
  color: #c92f42;
  margin-bottom: 8px;
  font-family: 'Old Standard TT', serif;
  text-align: center;
}

/* Reminder box outside column */
.reminder-box {
  margin-top: 12px;
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(14px);
  border-radius: 28px;
  border: 1px solid rgba(255,255,255,0.3);
  padding: 12px 18px;
  text-align: center;
  font-size: 1.2rem;
  color: rgba(255,255,255);
}

/* Crush Cards */
.crush-card {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(14px);
  border-radius: 28px;
  padding: 14px 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  width: 100%;
  margin-bottom: 12px;
  opacity:0;
  transform: translateY(20px);
  animation: slideIn 0.4s forwards;
}
@keyframes slideIn {
  to { opacity:1; transform:translateY(0); }
}

/* Empty state */
.empty-state {
  height: 200px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.25rem;
  color:white;
  font-weight:600;
  text-align:center;
}

/* Cancel Button */
.cancel-btn {
  background: linear-gradient(180deg,#ffeaf0,#ffd7dff1);
  color: #c84a5a;
  border: 1px solid rgba(200,74,90,0.12);
  padding: 8px 18px;
  border-radius: 999px;
  font-weight:600;
  font-size: 0.9rem;
}

/* Avatar */
.small-avatar {
  width:44px;height:44px;border-radius:999px; object-fit:cover;
  border:2px solid rgba(255,255,255,0.8);
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

/* Heart animation */
@keyframes heartBeat {
  0%,100% { transform: scale(1); }
  25%,75% { transform: scale(1.2); }
  50% { transform: scale(1.4); }
}

.heart-bg {
  animation: heartBeat 1.2s ease-in-out infinite;
  transform-origin: center;
}

/* Crush On You card */
.crush-on-you {
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(14px);
  border-radius:28px;
  padding: 20px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  width:100%;
  animation: popIn 0.6s ease forwards;
  opacity:0;
}
@keyframes popIn {
  0% { transform: scale(0.8); opacity:0; }
  60% { transform: scale(1.05); opacity:1; }
  100% { transform: scale(1); opacity:1; }
}

/* Responsive grid */
.grid-cols-responsive {
  display: grid;
  gap: 2rem;
}
@media (min-width: 1024px) { .grid-cols-responsive { grid-template-columns: 1fr 1fr; } }
</style>
</head>

<body>

<!-- NAVBAR -->
<div class="nav-box rounded-2xl px-4 sm:px-6 py-3 flex flex-col sm:flex-row items-center justify-between mb-10 gap-3 sm:gap-0">
  <div class="flex items-center space-x-3">
      <div class="cursor-pointer font-bold text-white">Logo</div> 
  </div>
  <div class="flex items-center space-x-4 sm:space-x-8 text-[#7b3a43] font-medium flex-wrap justify-center">
    <div class="cursor-pointer">Home</div>
    <div class="cursor-pointer">Match</div>
    <div class="cursor-pointer">Propose</div>
    <div class="cursor-pointer">Crush</div>
  </div>
  <div>
    <img src="https://i.pinimg.com/736x/76/07/9b/76079b98096e5da25426248dba5d72ce.jpg"
         alt="profile" class="w-10 h-10 rounded-full border" />
  </div>
</div>

<!-- MAIN TITLE -->
<h1 class="text-center text-6xl text-[#c82f41] mb-8" style="font-family: 'Jomolhari', serif;">
  Crushes
</h1>

<!-- GRID COLUMNS -->
<div class="grid grid-cols-responsive px-4 lg:px-16 gap-6">

  <!-- LEFT COLUMN -->
  <div>
    <div class="column-box">
      <h2 class="column-title">People You’ve Crushed</h2>
      <div id="crush-left-column" class="scrollable">
        <p class="text-placeholder">Loading your crushes...</p>
      </div>
    </div>
    <div class="reminder-box">You can cancel a crush only after 24 hours.</div>
  </div>

  <!-- RIGHT COLUMN -->
  <div class="crush-on-you">
    <h2 class="column-title">Crush On You</h2>
    <div id="heart" class="relative w-36 h-36 mt-2">
      <svg viewBox="0 0 64 64" class="w-full h-full heart-bg">
        <defs>
          <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="#ff6b7a"/>
            <stop offset="40%" stop-color="#ff435e"/>
            <stop offset="90%" stop-color="#ff2b4a"/>
          </linearGradient>
        </defs>
        <path d="M32 58s-18-12.8-25-21.2C0 26 15 10 25 18c4 3.2 7 6.8 7 6.8s3-3.6 7-6.8c10-8 25 8 18 18.8C50 45.2 32 58 32 58z"
              fill="url(#g1)" stroke="#ff4055" stroke-width="1.6"/>
      </svg>
      <div class="absolute inset-0 flex items-center justify-center z-10">
        <span id="heartNumber" class="text-white text-4xl font-extrabold" style="font-family: 'Itim', cursive;">0</span>
      </div>
    </div>
    <p class="mt-5 text-white">~~Someone can't stop thinking about you~~</p>
  </div>

</div>

<script>
const API_BASE = '/api/v1/crushes';
const crushContainer = document.getElementById('crush-left-column');
const heartNumber = document.getElementById('heartNumber');

async function fetchMyCrushes() {
  try {
    const res = await fetch(`${API_BASE}/my`);
    if (!res.ok) throw new Error('Failed to fetch crushes');
    const data = await res.json();
    return data.data || [];
  } catch (err) {
    console.error(err);
    return [];
  }
}

async function fetchCrushedMeCount() {
  try {
    const res = await fetch(`${API_BASE}/me`);
    if (!res.ok) throw new Error('Failed to fetch count');
    const data = await res.json();
    return data.crushCount || 0;
  } catch (err) {
    console.error(err);
    return 0;
  }
}

function renderCrushCards(crushes) {
  crushContainer.innerHTML = '';
  if (crushes.length === 0) {
    const empty = document.createElement('div');
    empty.className = 'empty-state';
    empty.textContent = 'You haven’t crushed anyone yet.';
    crushContainer.appendChild(empty);
    return;
  }

  crushes.forEach((crush, index) => {
    const card = document.createElement('div');
    card.className = 'crush-card';
    card.style.animationDelay = `${index * 0.08}s`;
    card.innerHTML = `
      <div class="flex items-center space-x-4">
        <img src="${crush.photos?.[0]?.url || 'https://i.pinimg.com/736x/76/07/9b/76079b98096e5da25426248dba5d72ce.jpg'}" alt="avatar" class="small-avatar"/>
        <div class="text-white font-semibold">${crush.nickname || 'Unknown'}, ${crush.age || 20}</div>
      </div>
      <button class="cancel-btn">Cancel</button>
    `;
    card.querySelector('button').addEventListener('click', async () => {
      try {
        await fetch(`${API_BASE}/${crush._id}`, { method: 'DELETE' });
        card.remove();
      } catch (err) {
        alert('Cannot cancel crush now');
      }
    });
    crushContainer.appendChild(card);
  });
}

async function initCrushPage() {
  const myCrushes = await fetchMyCrushes();
  renderCrushCards(myCrushes);

  const count = await fetchCrushedMeCount();
  heartNumber.textContent = count;

  // Heart pop effect
  heartNumber.style.transform = 'scale(0.8)';
  setTimeout(()=> heartNumber.style.transform='scale(1.2)', 100);
  setTimeout(()=> heartNumber.style.transform='scale(1)', 400);
}

document.addEventListener('DOMContentLoaded', initCrushPage);
</script>

</body>
</html>
