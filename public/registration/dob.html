<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Birthday Input</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="/js/registration.js"></script>

    <style>
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .animate-float {
        animation: float 4s ease-in-out infinite;
      }

      .fade-in {
        animation: fadeIn 1.5s ease-out both;
      }

      .card {
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        min-height: 350px;
      }

      .dropdown-list {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(236, 72, 153, 0.3);
      }

      .next-btn {
        background: linear-gradient(
          135deg,
          #f78998 0%,
          #fa97a9 50%,
          #f78998 100%
        );
        border-width: 0.11rem;
        border-style: solid;
        border-top-color: #ffffffcc;
        border-bottom-color: #ffffffcc;
        border-left-color: #fa97a9;
        border-right-color: #fa97a9;
        border-radius: 55px;
        box-shadow: 0px 36.86px 13.98px rgba(255, 106, 106, 0.02),
          0px 20.34px 12.71px rgba(255, 106, 106, 0.08),
          0px 8.9px 8.9px rgba(255, 106, 106, 0.13),
          0px 2.54px 5.08px rgba(255, 106, 106, 0.15);
        position: absolute;
        bottom: 20px;
        right: 40px;
        width: 120px;
        height: 45px;
        overflow: hidden;
        transition: 0.25s ease;
      }

      .next-btn::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.35) 0%,
          rgba(255, 255, 255, 0) 40%,
          rgba(255, 255, 255, 0) 60%,
          rgba(255, 255, 255, 0.35) 100%
        );
        border-radius: 55px;
        pointer-events: none;
      }

      .next-btn:hover {
        transform: translateY(-2px) scale(1.02);
      }

      .mbti-btnB {
        position: relative;
        background: radial-gradient(
            circle at 30% 100%,
            rgba(255, 255, 255, 0.55) 0%,
            rgba(255, 255, 255, 0.25) 35%,
            rgba(255, 182, 193, 0.18) 60%,
            rgba(255, 160, 180, 0.1) 80%,
            rgba(255, 150, 170, 0.05) 100%
          ),
          rgba(255, 192, 203, 0.25);
        border-radius: 1.2rem;
        color: #111;
        font-weight: 500;
        transition: all 0.25s ease-in-out;
        overflow: hidden;
        z-index: 1;
        box-shadow: inset 0 0 1px rgba(255, 255, 255, 0.6),
          inset 0 -1px 3px rgba(255, 255, 255, 0.4);
      }

      .mbti-btnB::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        padding: 1.4px;
        background: linear-gradient(
          150deg,
          rgba(255, 255, 255, 0.9),
          rgba(255, 190, 210, 0.65)
        );
        -webkit-mask: linear-gradient(#fff 0 0) content-box,
          linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        z-index: -1;
      }

      .mbti-btnB:hover {
        transform: scale(1.06);
        box-shadow: 0 0 18px rgba(255, 180, 200, 0.85);
      }

      .selected {
        background: radial-gradient(
            circle at 30% 100%,
            rgba(255, 255, 255, 0.55) 0%,
            rgba(255, 160, 180, 0.4) 50%,
            rgba(255, 100, 130, 0.25) 80%
          ),
          linear-gradient(to bottom right, #ff8eb5, #ff4f85);
        color: black;
        box-shadow: 0 0 22px rgba(255, 110, 150, 0.8);
        transform: scale(1.08);
      }
    </style>
  </head>

  <body
    class="flex items-center justify-center min-h-screen px-4 bg-cover bg-center bg-no-repeat"
    style="background-image: url('bgimg.jpg')"
  >
    <div class="relative w-full max-w-xl mx-auto px-2 sm:px-4">
      <!-- Back button -->
      <div class="absolute -top-24 left-0 sm:-top-20 z-50">
        <button
          id="backBtn"
          class="mbti-btnB flex items-center justify-center gap-2 w-[90px] sm:w-[110px] h-[42px] sm:h-[50px] font-semibold text-[14px] sm:text-[18px] cursor-pointer"
        >
          <i class="fa-solid fa-arrow-left text-[14px] sm:text-[18px]"></i>
          <span>Back</span>
        </button>
      </div>

      <div
        class="card animate-float fade-in bg-white/15 rounded-3xl p-8 sm:p-10 md:p-12 lg:p-14 text-center shadow-2xl w-full max-w-[640px] border border-white/30 relative"
      >
        <!-- When's your birthday? -->
        <h2
          class="font-[Inter] font-normal text-xl sm:text-2xl md:text-3xl lg:text-4xl text-black mb-10 drop-shadow-sm"
        >
          When's your birthday?
        </h2>

        <!-- Day, Month, Year -->
        <div class="flex flex-col items-center mt-10">
          <div class="flex flex-wrap justify-center gap-4 sm:gap-6 mb-10">
            <!-- DAY -->
            <div
              class="relative flex flex-col items-center w-24 sm:w-28 md:w-36"
            >
              <label class="text-black font-medium mb-1 text-sm sm:text-base">
                Day
              </label>
              <button
                id="dayBtn"
                class="dropdown-btn w-full px-4 py-3 text-base sm:text-lg rounded-full border border-black bg-transparent text-gray-700 flex justify-between items-center backdrop-blur-sm"
              >
                <span>DD</span>
                <span style="color: #ff4d6d">▼</span>
              </button>
              <ul
                id="dayList"
                class="dropdown-list absolute left-0 top-full mt-1 hidden bg-white rounded-xl max-h-48 overflow-y-auto w-full z-50"
              ></ul>
            </div>

            <!-- MONTH -->
            <div
              class="relative flex flex-col items-center w-32 sm:w-36 md:w-44"
            >
              <label class="text-black font-medium mb-1 text-sm sm:text-base">
                Month
              </label>
              <button
                id="monthBtn"
                class="dropdown-btn w-full px-4 py-3 text-base sm:text-lg rounded-full border border-black bg-transparent text-gray-700 flex justify-between items-center backdrop-blur-sm"
              >
                <span>MM</span>
                <span style="color: #ff4d6d">▼</span>
              </button>
              <ul
                id="monthList"
                class="dropdown-list absolute left-0 top-full mt-1 hidden bg-white rounded-xl max-h-48 overflow-y-auto w-full z-50"
              ></ul>
            </div>

            <!-- YEAR -->
            <div
              class="relative flex flex-col items-center w-28 sm:w-32 md:w-36"
            >
              <label class="text-black font-medium mb-1 text-sm sm:text-base">
                Year
              </label>
              <button
                id="yearBtn"
                class="dropdown-btn w-full px-4 py-3 text-base sm:text-lg rounded-full border border-black bg-transparent text-gray-700 flex justify-between items-center backdrop-blur-sm"
              >
                <span>YYYY</span>
                <span style="color: #ff4d6d">▼</span>
              </button>
              <ul
                id="yearList"
                class="dropdown-list absolute left-0 top-full mt-1 hidden bg-white rounded-xl max-h-48 overflow-y-auto w-full z-50"
              ></ul>
            </div>
          </div>
        </div>

        <!-- Next -->
        <button
          id="nextBtn"
          class="next-btn text-lg font-medium text-black cursor-pointer"
        >
          Next
        </button>
      </div>
    </div>
    <script>
      // ===========================
      // DROPDOWN INITIALIZATION
      // ===========================
      document.addEventListener("DOMContentLoaded", function () {
        const createList = (id, values, type) => {
          const list = document.getElementById(id);
          list.innerHTML = "";

          values.forEach((val) => {
            const li = document.createElement("li");
            li.textContent = val;
            li.className =
              "px-4 py-3 hover:bg-[#F7788F] cursor-pointer border-b border-gray-100 last:border-b-0";
            li.onclick = () => selectValue(type, val);
            list.appendChild(li);
          });
        };

        createList(
          "dayList",
          Array.from({ length: 31 }, (_, i) => String(i + 1).padStart(2, "0")),
          "day"
        );

        createList(
          "monthList",
          Array.from({ length: 12 }, (_, i) => String(i + 1).padStart(2, "0")),
          "month"
        );

        const currentYear = new Date().getFullYear();
        createList(
          "yearList",
          Array.from({ length: currentYear - 1899 }, (_, i) => currentYear - i),
          "year"
        );

        ["dayBtn", "monthBtn", "yearBtn"].forEach((btnId) => {
          const button = document.getElementById(btnId);
          const dropdown = document.getElementById(
            btnId.replace("Btn", "List")
          );
          button.dataset.selected = "false";

          button.addEventListener("click", (e) => {
            e.stopPropagation();
            document
              .querySelectorAll(".dropdown-list")
              .forEach((dd) => dd.classList.add("hidden"));
            dropdown.classList.toggle("hidden");
          });
        });

        document.addEventListener("click", () => {
          document
            .querySelectorAll(".dropdown-list")
            .forEach((dd) => dd.classList.add("hidden"));
        });
      });

      function selectValue(type, value) {
        const button = document.getElementById(`${type}Btn`);
        button.querySelectorAll("span")[0].textContent = value;
        button.dataset.selected = "true";
      }

      // ===========================
      // REQUIRED BY registration.js
      // ===========================
      window.collectPageData = function () {
        const day = document
          .getElementById("dayBtn")
          .querySelector("span").textContent;
        const month = document
          .getElementById("monthBtn")
          .querySelector("span").textContent;
        const year = document
          .getElementById("yearBtn")
          .querySelector("span").textContent;

        if (day === "DD" || month === "MM" || year === "YYYY") {
          return null;
        }

        const dobString = `${year}-${month}-${day}`;
        return { dob: dobString };
      };

      window.prefillPage = function (data) {
        if (!data || !data.dob) return;

        const d = new Date(data.dob);
        if (isNaN(d)) return;

        const day = String(d.getUTCDate()).padStart(2, "0");
        const month = String(d.getUTCMonth() + 1).padStart(2, "0");
        const year = d.getUTCFullYear();

        selectValue("day", day);
        selectValue("month", month);
        selectValue("year", year);
      };

      // ===========================
      // UI BUTTONS
      // ===========================
      /* document.getElementById("backBtn").addEventListener("click", () => {
        alert("backbtn clicked");
        goToStep(pageStep - 1, registrationSteps);
      }); */

      document.getElementById("nextBtn").addEventListener("click", () => {
        alert("next button clicked");
        const data = window.collectPageData();

        if (!data) {
          alert("⚠️ Please select a full birthday before continuing!");
          return;
        }

        // Trigger the exact event registration.js listens to
        document.dispatchEvent(new CustomEvent("registration:submit"));
      });
    </script>
  </body>
</html>
